<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firecrawl Lite - 网页抓取工具</title>
  <link rel="stylesheet" href="/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/marked@11.0.0/marked.min.js" 
          integrity="sha384-4Tu0AVV0VM7dUwfPXGZDt6OI+2sNBSrQZe1Gmz87gzoio1n3IeHCMwRrfqSi4/Oh" 
          crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"
          integrity="sha384-vdScihEZCfbPnBQf+lc7LgXUdJVYyhC3yWHUW5C5P5GpHRqVnaM6HJELJxT6IqwM"
          crossorigin="anonymous"></script>
</head>
<body>
  <!-- SVG Icon Sprite -->
  <object data="/icons.svg" type="image/svg+xml" style="display: none;"></object>
  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-content">
      <img src="/image.png" alt="Firecrawl Lite" class="hero-image">
      <h1>Firecrawl Lite</h1>
      <p class="hero-subtitle-en">Web to Markdown</p>
      <p class="hero-subtitle">将任意网页转换为干净、结构化的 Markdown 格式</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div class="card">
      <form id="scrapeForm">
        <div class="form-group">
          <label for="url">网页地址（支持多行批量输入）</label>
          <textarea 
            id="url" 
            name="url" 
            rows="1"
            placeholder="https://example.com" 
            required
            autofocus
          ></textarea>
        </div>

        <div class="options">
          <div class="checkbox-wrapper">
            <input type="checkbox" id="renderJS" name="renderJS">
            <label for="renderJS">渲染 JavaScript（较慢，适用于单页应用）</label>
          </div>
          <div class="checkbox-wrapper">
            <input type="checkbox" id="enableCrawl" name="enableCrawl">
            <label for="enableCrawl">爬取相同目录的所有页面</label>
          </div>
        </div>

        <!-- Crawl options (hidden by default) -->
        <div id="crawlOptions" class="crawl-options" style="display:none">
          <div class="crawl-hint">
            将爬取路径前缀为 <code id="detectedPrefix">/</code> 的所有页面
          </div>
          
          <div class="inline-controls">
            <div class="form-group-inline">
              <label for="maxPages">最大页数</label>
              <input type="number" id="maxPages" name="maxPages" value="50" min="1" max="200" />
            </div>
            
            <div class="form-group-inline">
              <label for="displayMode">结果展示</label>
              <select id="displayMode" name="displayMode">
                <option value="merged">合并为单文件</option>
                <option value="list">分页列表</option>
              </select>
            </div>
          </div>
        </div>

        <button type="submit" class="button-primary" id="submitBtn" aria-label="开始抓取网页">
          开始抓取
          <span class="loading-spinner" id="loading" style="display: none;" role="status" aria-label="正在加载">
            <svg class="icon"><use href="/icons.svg#icon-spinner"></use></svg>
          </span>
        </button>
      </form>

      <div class="error" id="error" role="alert" aria-live="assertive"></div>
    </div>

    <div class="result" id="result">
      <div class="card">
        <div class="result-header">
          <span class="result-label">Markdown 输出</span>
          <div class="button-group">
            <button 
              type="button" 
              class="button-secondary" 
              id="copyBtn"
              aria-label="复制 Markdown 到剪贴板"
              data-copied-text="已复制"
              data-error-text="复制失败">
              <svg class="icon icon-sm"><use href="/icons.svg#icon-copy"></use></svg>
              <span>复制</span>
            </button>
            <button 
              type="button" 
              class="button-secondary" 
              id="downloadBtn"
              aria-label="下载 Markdown 文件"
              data-downloaded-text="已下载">
              <svg class="icon icon-sm"><use href="/icons.svg#icon-download"></use></svg>
              <span>下载</span>
            </button>
          </div>
        </div>
        <textarea id="markdown" readonly></textarea>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-content" id="footerContent">
      <a id="githubLink" href="https://github.com" target="_blank">GitHub</a> · 
      <a id="healthCheckLink" href="/api/health" target="_blank">服务状态</a> · 
      <span id="tagline">简约而不简单</span>
    </div>
  </div>

  <!-- Preview Mode (Safari-style Unified Reader) -->
  <div id="previewMode" class="preview-container" style="display: none;">
    <!-- Unified Toolbar -->
    <header class="preview-toolbar" role="banner">
      <button class="close-btn" aria-label="关闭预览">
        <svg class="icon" width="24" height="24" aria-hidden="true"><use href="/icons.svg#icon-x"></use></svg>
      </button>
      <h1 class="preview-title" id="pageTitle">加载中...</h1>
      <nav class="toolbar-actions" aria-label="内容操作">
        <button class="action-btn" id="purifyBtn" style="display: none;" aria-label="AI提纯内容">
          <svg class="icon" width="16" height="16" aria-hidden="true"><use href="/icons.svg#icon-sparkles"></use></svg>
          <span>提纯</span>
        </button>
        <button class="action-btn" data-action="copy" aria-label="复制当前页">
          <svg class="icon" width="16" height="16" aria-hidden="true"><use href="/icons.svg#icon-copy"></use></svg>
          <span>复制</span>
        </button>
        <button class="action-btn" data-action="export" aria-label="导出当前页">
          <svg class="icon" width="16" height="16" aria-hidden="true"><use href="/icons.svg#icon-download"></use></svg>
          <span>导出</span>
        </button>
        
        <!-- Pagination Controls (shown in batch mode) -->
        <div class="pagination" id="pagination" style="display: none;" role="navigation" aria-label="页面导航">
          <button class="page-btn" id="prevBtn" disabled aria-label="上一页">
            <svg class="icon" width="16" height="16" aria-hidden="true"><use href="/icons.svg#icon-arrow-left"></use></svg>
          </button>
          <span class="page-indicator" id="pageIndicator" aria-live="off" aria-atomic="true">1 / 1</span>
          <button class="page-btn" id="nextBtn" disabled aria-label="下一页">
            <svg class="icon" width="16" height="16" aria-hidden="true"><use href="/icons.svg#icon-arrow-right"></use></svg>
          </button>
        </div>
      </nav>
      <button class="done-btn" aria-label="完成阅读">完成</button>
    </header>
    
    <!-- Content Area (multi-page support) -->
    <div class="preview-content" id="previewContent">
      <!-- .page-wrapper elements will be dynamically generated -->
    </div>
    
    <!-- Progress Indicator (shown in batch mode) -->
    <div class="progress-indicator" 
         id="progressIndicator" 
         role="status" 
         aria-label="阅读进度" 
         aria-live="off"
         style="display: none;">
      <!-- .progress-dot elements will be dynamically generated -->
    </div>
    
    <!-- Toast Container (preview mode only) -->
    <div class="preview-toast" id="previewToast" role="alert" aria-live="polite"></div>
  </div>

  <script src="/config.js"></script>
  <script>
    // API地址配置（由Caddy反向代理统一处理）
    // 本地开发: http://localhost:8000 → Caddy反向代理
    //   ├─ /api/* → localhost:3000 (后端)
    //   └─ /* → localhost:8080 (前端)
    // 生产环境: https://example.com → Caddy反向代理
    //   ├─ /api/* → 自有服务器:3000
    //   └─ /* → Vercel (前端)
    // 
    // 前端使用相对路径 '/api/scrape'，反向代理自动转发
    // 无需设置 window.API_BASE，使用app.js默认的 '/api'
  </script>
  <script src="/app.js"></script>
  <script>
    // 初始化footer链接
    document.getElementById('githubLink').href = AppConfig.get('links.github');
    document.getElementById('healthCheckLink').href = AppConfig.get('links.healthCheck');
    document.getElementById('tagline').textContent = AppConfig.get('tagline', '简约而不简单');
  </script>
</body>
</html>
