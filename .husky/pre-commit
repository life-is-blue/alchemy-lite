#!/bin/sh
# AI-Assisted Workflow Pre-commit Checks
#
# Philosophy: AI generates, tests verify, humans decide
#   1. AI generates code (fast, but may have bugs)
#   2. Tests verify behavior (mandatory, blocking)
#   3. Humans review logic (mandatory, blocking)
#   4. Hooks catch omissions (warnings, non-blocking)
#
# Why Git Hooks instead of Codebuddy Hooks?
#   - Simpler (10 lines shell vs 200 lines TS)
#   - Faster (no AI round trip)
#   - More reliable (no external dependencies)
#
# For 3000-line projects, this is enough.
# If project grows >10k lines, reconsider automated Skills.

# 1. Unit tests must pass (AI can write broken code)
echo "▶ Running unit tests..."
npm test || {
  echo "❌ Unit tests failed"
  exit 1
}

# 2. Code review required (AI doesn't understand business logic)
if [ ! -f ".approved-commit" ]; then
  echo "❌ No code review approval"
  exit 1
fi

# 3. Documentation consistency check (non-blocking warnings)
.husky/doc-sync-check

echo "✅ Pre-commit checks passed"